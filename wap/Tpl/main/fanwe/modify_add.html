<?php
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/weebox.css";	
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/fanweUI.css";	
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/style.css";	
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/color.css";		
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/uc_address.css";	

$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery-1.6.2.min.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.bgiframe.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.timer.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.weebox.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.touchwipe.js";

$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/fanwe_utils/fanweUI.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/fanwe_utils/fanweUI.js";

$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/script.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/script.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/uc_address.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/uc_address.js";

?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>修改地址</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Mobile Devices Support @begin -->
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="false" name="twcClient" id="twcClient">
		<meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
		<meta content="no-cache" http-equiv="pragma">
		<meta content="0" http-equiv="expires">
		<!--允许全屏模式-->
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<!--指定sari的样式-->
		<!--<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta content="telephone=no" name="format-detection" />-->
		<!-- Mobile Devices Support @end -->
		<script type="text/javascript " src="{$TMPL}/html/js/jquery.min.js "></script>

		<link rel="stylesheet" href="{$TMPL}/html/css/modify_add.css" />
		<link rel="stylesheet" href="{$TMPL}/html/css/head_foot.css" />
		<style type="text/css">
			.loading {
				width: 100%;
				height: 100%;
				background-color: #fff;
				position: fixed;
				left: 0;
				right: 0;
				margin: 0 auto;
				z-index: 99;
				transition: all 1s ease 0.5s;
			}
			
			.loading img {
				width: 20%;
				position: fixed;
				top: 40%;
				left: 0;
				right: 0;
				margin: 0 auto;
			}
		</style>
	</head>

	<body>
		<div class="loading">
			<img src="{$TMPL}/html/img/icon/gooey_2x.gif" alt="" />
		</div>

		<div class="box">
			<header>
				<div class="spell_details">
					<div class="spell_details_wid clearfix">
						<a onClick="window.history.go(-1);" class="back"><img src="{$TMPL}/html/img/icon/back.png" alt="" /></a>
						<p class="details_details">修改地址</p>
						<button class="head_btn" id="submit_form">保存</button>
						<!--<img src="img/icon/tuangoushangpin2.png" alt="" class="ka_city_right" />-->
					</div>
					<div class="hotshow_title_down">
						<ul>
							<li>
								<a href="#script"><img src="{$TMPL}/html/img/icon/imgshou3.png" alt="" /></a>
							</li>
							<li>
								<a href="#script"><img src="{$TMPL}/html/img/icon/imgshou1.png" alt="" /></a>
							</li>
							<li>
								<a href="#script"><img src="{$TMPL}/html/img/icon/imgshou2.png" alt="" /></a>
							</li>
						</ul>
					</div>
				</div>
				<!--头部下拉-->
				<div class="head_stance"></div>

			</header>
			<section>
				<!--内容开始-->
				<div class="wid">
					<div class="wid_small">
						<form name="my_address" method="post" action="">
							<div class="mod_sty clearfix">
								<p>收货人姓名：</p>
								<input type="text" placeholder="{$data.consignee}" name="consignee" id="consignee" />
							</div>
							<!--下拉选择城市-->
							<div class="add_select">
								<!--点击的地方--> 
								<div class="select">
									<ul>
										<li class="province">
											<input type="text" placeholder="{$data.sheng_name}" name="region_lv2" id="region_lv2"><img src="{$TMPL}/html/img/icon/shuliang_07.png" alt="" />
										</li>
										<li class="city">
											<input type="text" placeholder="{$data.shi_name}" id="show_shi" name="region_lv3"><img src="{$TMPL}/html/img/icon/shuliang_07.png" alt="" />
										</li>
										<li class="region">
											<input type="text" placeholder="{$data.qu_name}" id="show_qu" name="region_lv4"><img src="{$TMPL}/html/img/icon/shuliang_07.png" alt="" />
										</li>
									</ul>
								</div>
								<!--点击出现所对应的东西-->
								<div class="sub_style province_sub"><!--省市选择列表-->
									<ul id="sheng">
										{foreach from=$data.city_list item=val}
										   <li value="{$val.id}" >{$val.name}</li>
										{/foreach}
									</ul>
								</div>
								<div class="sub_style city_sub"><!--市选择列表-->
									<ul id="shi">
										{foreach from=$data.shi_list item=val}
										   <li value="{$val.id}" >{$val.name}</li>
										{/foreach}
									</ul>
								</div>
								<div class="sub_style region_sub"><!--市区选择列表-->
									<ul id="qu">
											{foreach from=$data.qu_list item=val}
										   <li value="{$val.id}" >{$val.name}</li>
										{/foreach}
									</ul>
								</div>
							</div>
							<div class="mod_sty clearfix">
								<p>详细地址：</p>
								<input type="text" placeholder="" value="{$data.address}" id="address" name="address"/>
							</div>
							<div class="mod_sty clearfix">
								<p>邮编：</p>
								<input type="text" placeholder="" value="{$data.zip}" id="zip" name="zip"/>
							</div>
							<div class="mod_sty clearfix">
								<p>手机号：</p>
								<input type="text" placeholder="" value="{$data.mobile}" id="mobile" name="mobile"/>
							</div>

							<input type="hidden" id="address_id" value="{$data.id}">
						</form>
						<button class="btn" id="address_del">删除地址</button>
					</div>
				</div>

				<!--内容结束-->
				<!--页脚-->
			<div class="footer"></div>
			</section>
		</div>
		<script type="text/javascript " src="{$TMPL}/html/js/loading.js "></script>
		<script type="text/javascript ">
		//表单提交
	    $("#submit_form").click(function(){
		  	var consignee = $("#consignee").val();
			var region_lv2 =  $("#region_lv2").attr("values");
			var region_lv3 = $("#show_shi").attr("values");
			var region_lv4 = $("#show_qu").attr("values");
			var address = $("#address").val();
			var zip = $("#zip").val();
			var mobile = $("#mobile").val();
			var checked = $("#checked").val();
			var address_id = $("#address_id").val();
		     $.ajax({
				        url:'{url a="index" r="uc_address#update"}',
						data: {address_id:address_id,consignee:consignee,region_lv2:region_lv2,region_lv3:region_lv3,region_lv4:region_lv4,address:address,zip:zip,mobile:mobile,checked:checked},
						dataType:"json",
						type: "post",
						success: function(obj){
						   if(obj == 0){
						   		alert("修改失败，请稍后重试！");
						   }else{
						   		alert("修改成功！");
								location.href = obj;
						   		
						   }
						
							
						}
                });
			});
			//删除地址
			 $("#address_del").click(function(){
			var address_id = $("#address_id").val();
		     $.ajax({
				        url:'{url a="index" r="uc_address#del"}',
						data: {address_id:address_id},
						dataType:"json",
						type: "post",
						success: function(obj){
						   if(obj == 0){
						   		alert("删除失败，请稍后重试！");
						   }else{
						   		alert("删除成功！");
								location.href = obj;
						   		
						   }
						
							
						}
                });
			});
		
		 $("#sheng li").click(function(){
		  	var sheng_id = $(this).val();
			$('#region_lv2').attr('values',sheng_id);
		
		     $.ajax({
				 url:'{url a="index" r="uc_address#getShi"}',
						data: {id:sheng_id},
						dataType:"json",
						type: "post",
						success: function(obj){
						//alert(obj);
						
							$('#shi').children().remove();
							$('#qu').children().remove();
							$('#shi').html(obj);
							$('#show_shi').val('市');
							$('#show_qu').val('区');
						}
                });
			});
		 $("#shi").on('click','li',function(){
				var shi_id = $(this).val();
				$('#show_shi').attr('values',shi_id);
				 $.ajax({
					 url:'{url a="index" r="uc_address#getQu"}',
							data: {id:shi_id},
							dataType:"json",
							type: "post",
							success: function(obj){
							    $('#qu').children().remove();
								$('#qu').html(obj);
								$('#show_qu').val('区');
							}
					});
			
			});
		 $("#qu").on('click','li',function(){
				var qu_id = $(this).val();
				$('#show_qu').attr('values',qu_id);
			});
		
		
		
		
		
		
//		仿select
			$(".select ul li").click(function() {
				$(".sub_style").eq($(this).index()).css("display", "block").siblings().css("display", "none");//点击出现对应的列表
				$(".select").css("display", "block");//自己不会消失
				var m = $(".sub_style").eq($(this).index()).find("li").length;//m为当前对应下拉列表的长度
				for(var i = 0; i < m; i++){//循环列表内容
					$(".sub_style").eq($(this).index()).find("li").eq(i).click(function(){//点击列表内容
						var thet_Txt=$(this).html();//获取点击的内容
						$(this).css("border-right","1px solid #595757").siblings().css("border","none")
						var r=$(this).parent().parent().index();//找到子元素所在列表的父级
						$(".select ul li").eq(r-1).find("input").val(thet_Txt);//吧点击的内容赋值给所对应位置
						$(this).parent().parent().css("display","none");//下拉列表消失
					})
				}
			})
			//			头部下拉
			$(".ka_city_right ").click(function() {
				if($(".hotshow_title_down ").is(":hidden ")) {
					$(".hotshow_title_down ").slideDown();
				} else {
					$(".hotshow_title_down ").slideUp();
				}
			});
		</script>

	</body>

</html>